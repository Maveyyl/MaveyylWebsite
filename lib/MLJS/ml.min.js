/*! ml 1.2.0 2016-05-25 */
var ml=function(){function a(a){a=a||{};var b={};return b.learning_rate=a.learning_rate||0,b.stop_criteria=a.stop_criteria||.001,b.min_iter=a.min_iter||100,b.max_iter=a.max_iter||1e3,b.regularization_parameter=a.regularization_parameter||0,b.gradient_check_parameter=a.gradient_check_parameter||1e-4,b.hypothesis_function=a.hypothesis_function,b.cost_function=a.cost_function,b.test_function=a.test_function,b.feature_scalling=a.feature_scalling,void 0===a.feature_scalling&&(b.feature_scalling=!1),b.gradient_check=a.gradient_check,void 0===a.gradient_check&&(b.gradient_check=!1),b.perform_test=a.perform_test,void 0===a.perform_test&&(b.perform_test=!1),b.add_bias=a.add_bias,void 0===a.add_bias&&(b.add_bias=!0),b.alpha=b.learning_rate,b.lambda=b.regularization_parameter,b.epsilon=b.gradient_check_parameter,b}function b(b,c,d,e){var f;this.config=a(e),this.training_size=b.length,this.feature_count=d.length,this.M=this.training_size,this.M_test=void 0,this.N=this.feature_count,this.X=i.matrix_copy(b),this.X_test=void 0,this.config.feature_scalling&&(f=k.feature_scalling(this.X,!0),this.X=f.matrix,this.feature_scalling_parameters=f.feature_scalling_parameters),this.config.add_bias&&(this.X=k.add_bias_feature(this.X,!0)),this.y=h.multi_array_copy(c),this.y_test=void 0,this.theta=h.multi_array_copy(d),f=k.data_shuffle(this.X,this.y,!0),this.X=f.X,this.y=f.y,this.config.perform_test&&(this.M_test=Math.round(.3*this.M),this.M=this.M-this.M_test,this.X_test=i.matrix_slice(this.X,this.M),this.X=i.matrix_slice(this.X,0,this.M),Array.isArray(c[0])?(this.y_test=i.matrix_slice(this.y,this.M),this.y=i.matrix_slice(this.y,0,this.M)):(this.y_test=this.y.slice(this.M),this.y=this.y.slice(0,this.M))),this.J=[],this.iter_count=0,this.divergence=!1,this.error=!1,this.message="",this.execution_time=0}var d={},e=function(){return{}}();d.utils=e;var f=function(){function a(a){return 1/(1+Math.exp(-a))}function b(b){var c=a(b);return c*(1-c)}function c(a){var b=Math.log(a);return b===-(1/0)&&(b=-Number.MAX_VALUE),b}function d(){}return{sigmoid:a,sigmoid_gradient:b,log:c,test:d}}();d.math_utils=f;var g=function(){function a(a,b){b||(a=array_copy(a));for(var c,d,e=a.length;e;)c=Math.random()*e|0,e--,d=a[e],a[e]=a[c],a[c]=d;return a}function b(){}return{array_shuffle:a,test:b}}();d.array_utils=g;var h=function(){function a(b){if(void 0===b)return b;var c=b.length;if(void 0===c)return b;for(var d=new Array(c),e=0;c>e;e++)void 0!==b[e].length?d[e]=a(b[e]):d[e]=b[e];return d}function b(b,c){c||(b=a(b));var d=[];void 0!==b.length&&d.push(b);for(var e,f,g;d.length>0;)for(e=d.pop(),g=e.length,f=0;g>f;f++)void 0!==e[f].length?d.push(e[f]):e[f]=Math.random();return b}return{multi_array_copy:a,multi_array_random_init:b}}();d.multi_array_utils=h;var i=function(){function a(a){var b,c;return b=a.length,c=0,b>0&&(c=a[0].length),[b,c]}function b(b){for(var c=new Array(b.length),d=0;d<b.length;d++)c[d]=a(b[d]);return c}function c(b,c){var d=a(b),e=d[0],f=d[1];c||(c=0,1===f&&(c=1));var g,h,i;if(0===c)for(g=new Array(f).fill(0),i=0;f>i;i++)for(h=0;e>h;h++)g[i]+=b[h][i];else for(g=new Array(e).fill(0),h=0;e>h;h++)for(i=0;f>i;i++)g[h]+=b[h][i];return g}function d(b,c){var d=a(b),e=a(c);if(d[0]!==e[0]||d[1]!==e[1])return!1;var f,g;for(f=0;f<d[0];f++)for(g=0;g<d[1];g++)if(b[f][g]!==c[f][g])return!1;return!0}function e(a){var b,c=a.length;if(void 0===c||0===c)return a;var d=new Array(c);if(Array.isArray(a[0]))for(b=0;c>b;b++)d[b]=a[b].slice();else for(b=0;c>b;b++)d[b]=a[b];return d}function g(b,c){c||(b=e(b));var d,g,h=a(b),i=h[0],j=h[1];for(d=0;i>d;d++)for(g=0;j>g;g++)b[d][g]=f.sigmoid(b[d][g]);return b}function h(a){var b,c,d,e=[];for(b=0;b<a.length;b++)for(c=0;c<a[b].length;c++)for(d=0;d<a[b][c].length;d++)e.push(a[b][c][d]);return e}function i(a,b){var c,d,e,f,g,h,i,j;for(e=b.length,j=0,c=new Array(e),d=0;e>d;d++)for(g=b[d][0],i=b[d][1],c[d]=new Array(g),f=0;g>f;f++)for(c[d][f]=new Array(i),h=0;i>h;h++)c[d][f][h]=a[j],j++;return c}function j(a,b,c){b=b||0,c=c||a.length;var d,e=c-b,f=new Array(e);for(d=0;e>d;d++)f[d]=a[b+d].slice();return f}return{matrix_size:a,matrix_array_size:b,matrix_sum:c,matrix_equals:d,matrix_copy:e,matrix_sigmoid:g,unroll_matrix_array:h,reroll_matrix_array:i,matrix_slice:j}}();d.matrix_utils=i;var k=function(){function a(a,b){b||(a=i.matrix_copy(a));for(var c=a.length,d=0;c>d;d++)a[d].unshift(1);return a}function b(a,b,c){c||(a=i.matrix_copy(a));var d,e,f,g=i.matrix_size(a),h=g[0],j=g[1];for(d=0;h>d;d++)for(e=0;j>e;e++)for(f=2;b+1>f;f++)a[d].push(Math.pow(a[d][e],f));return a}function d(a,b){b||(a=i.matrix_copy(a));var c,d,e=matrix_size(a),f=e[0],g=e[1],h=new Array(g).fill(0),j=new Array(g).fill(0);for(d=0;g>d;d++){for(c=1;f>c;c++)h[d]+=a[c][d];h[d]=h[d]/f}for(d=0;g>d;d++){for(c=0;f>c;c++)j[d]+=a[c][d]*a[c][d];j[d]=j[d]/f,j[d]=j[d]-h[d]*h[d],j[d]=Math.sqrt(j[d])}for(c=0;f>c;c++)for(d=0;g>d;d++)a[c][d]=(a[c][d]-h[d])/j[d];return{matrix:a,feature_scalling_parameters:{mean:h,std:j}}}function e(a,b,d,e){e||(a=i.matrix_copy(a));var f=matrix_size(a),g=f[0],h=f[1];for(r=0;r<g;r++)for(c=0;c<h;c++)a[r][c]=(a[r][c]-b[c])/d[c];return a}function f(a,b,c,d){var e,f,g,h;return e=(a+c)/(a+b+c+d),f=a/(a+b),g=a/(a+d),h=2*f*g/(f+g),{TP:a,FP:b,TN:c,FN:d,accuracy:e,precision:f,recall:g,f1_score:h}}function g(a,b,c){c||(a=i.matrix_copy(a),b=i.matrix_copy(b));for(var d,e,f=a.length;f;)d=Math.random()*f|0,f--,e=a[f],a[f]=a[d],a[d]=e,e=b[f],b[f]=b[d],b[d]=e;return{X:a,y:b}}function j(a){var b,c,d,e,f,g;for(c=a.length,g=new Array(c-1),b=0;c-1>b;b++)for(e=a[b+1],g[b]=new Array(a[b+1]),d=0;e>d;d++)f=a[b]+1,g[b][d]=new Array(f).fill(0);return g}function k(a,b,c,d){d||(a=h.multi_array_copy(a)),b=b||0,c=c||1,extents=c-b;var e,f,g,i,j,k;for(f=a.length,e=0;f>e;e++)for(i=a[e].length,g=0;i>g;g++)for(k=a[e][g].length,j=0;k>j;j++)a[e][g][j]=Math.random()*extents+b;return a}return{add_bias_feature:a,feature_polynomial_combine:b,feature_scalling:d,scale_features:e,compute_stats:f,data_shuffle:g,nn_theta_create:j,nn_theta_random_init:k}}();return d.ml_utils=k,b.prototype.predict=function(a){return a=a.slice(),a.unshift(1),this.config.hypothesis_function(a,this.theta)},b.prototype.gradient_descent=function(){var a=(new Date).getTime();if(this.config.gradient_check&&!this.check_gradient(this.X,this.y,this.theta,this.config.epsilon,this.config.cost_function))return this.error=!0,this.message="Gradient check failed, seems like the algorithm you're trying to use is broken, sorry.",this;0===this.config.alpha&&(this.config.alpha=this.choose_learning_rate(this.X,this.y,this.theta,this.config),this.config.learning_rate=this.config.alpha);for(var b=this.gradient_step(this.X,this.y),c=this.gradient_step(this.X,this.y);(Math.abs(b-c)>this.config.stop_criteria||this.iter_count<this.config.min_iter)&&this.iter_count<this.config.max_iter;){if(0>b-c){this.divergence=!0;break}b=c,c=this.gradient_step(this.X,this.y)}this.config.perform_test&&(this.test_results=this.config.test_function(this.X_test,this.y_test,this.theta));var d=(new Date).getTime();this.execution_time=d-a},b.prototype.batched_gradient_descent=function(a){var b=(new Date).getTime();if(this.config.gradient_check&&!this.check_gradient(this.X,this.y,this.theta,this.config.epsilon,this.config.cost_function))return this.error=!0,this.message="Gradient check failed, seems like the algorithm you're trying to use is broken, sorry.",this;for(var c=0;c<this.M;c+=a)this.gradient_step(this.X.slice(c,c+a),this.y.slice(c,c+a));this.config.perform_test&&(this.test_results=this.config.test_function(this.X_test,this.y_test,this.theta));var d=(new Date).getTime();this.execution_time=d-b},b.prototype.gradient_step=function(a,b){var c=this.config.cost_function(a,b,this.theta,this.config.lambda);for(j=0;j<this.N;j++)this.theta[j]-=this.config.alpha*c.grad[j];return this.J.push(c.J),this.iter_count++,c.J},b.prototype.online_gradient_descent=function(a,b){return a=a.slice(),a.unshift(1),a=[a],b=[b],this.gradient_step(a,b)},b.prototype.check_gradient=function(a,b,c,d,e){c=h.multi_array_copy(c);var f,g,i,j=e(a,b,c,0);for(n=0;n<this.N;n++)return c[n]+=d,f=e(a,b,c,0),c[n]-=2*d,g=e(a,b,c,0),c[n]+=d,i=(f.J-g.J)/(2*d),j.grad[n]===i&&0===i?!0:Math.abs(j.grad[n]-i)/(Math.abs(j.grad[n])+Math.abs(i))<2*d},b.prototype.choose_learning_rate=function(c,d,e,f){for(f=a(f),f.learning_rate=1,f.add_bias=!1,f.feature_scalling=!1,ctx=new b(c,d,e,f);!ctx.divergence;)f.learning_rate*=3,ctx=new b(c,d,e,f),ctx.gradient_descent();for(;ctx.divergence;)f.learning_rate/=3,ctx=new b(c,d,e,f),ctx.gradient_descent();return f.learning_rate},d.polynomial_regression=function(a,c,d,e){function f(a,b){var c,d=0,e=b.length;for(c=0;e>c;c++)d+=a[c]*b[c];return d}function g(a,b,c,d){var e,g,h,i;h=a.length,i=c.length;var j={J:0,grad:new Array(i).fill(0)},k=new Array(h),l=new Array(h);for(e=0;h>e;e++)k[e]=f(a[e],c),l[e]=k[e]-b[e];for(e=0;h>e;e++)j.J+=l[e]*l[e];for(j.J=j.J/(2*h),g=0;i>g;g++){for(e=0;h>e;e++)j.grad[g]+=l[e]*a[e][g];j.grad[g]=j.grad[g]/h}if(0!==d){var m=0;for(g=1;i>g;g++)m+=c[g]*c[g],j.grad[g]+=d*c[g]/h;j.J+=d*m}return j}e.hypothesis_function=f,e.cost_function=g;var h=new b(a,c,d,e);return h},d.logistic_regression=function(a,c,d,e){function g(a,b){var c,d=0,e=b.length;for(c=0;e>c;c++)d+=a[c]*b[c];return d=f.sigmoid(d)}function h(a,b,c,d){var e,h,i,j;i=a.length,j=c.length;var k={J:0,grad:new Array(j).fill(0)},l=new Array(i),m=new Array(i);for(e=0;i>e;e++)l[e]=g(a[e],c),m[e]=l[e]-b[e];for(e=0;i>e;e++)k.J+=b[e]*f.log(l[e])+(1-b[e])*f.log(1-l[e]);for(k.J=-1*k.J/i,h=0;j>h;h++){for(e=0;i>e;e++)k.grad[h]+=m[e]*a[e][h];k.grad[h]=k.grad[h]/i}if(0!==d){var n=0;for(h=1;j>h;h++)n+=c[h]*c[h],k.grad[h]+=d*c[h]/i;k.J+=d*n/(2*i)}return k}function i(a,b,c){var d,e,f=0,h=0,i=0,j=0,l=a.length;for(d=0;l>d;d++)e=Math.round(g(a[d],c)),1===b[d]?1===e?f++:j++:1===e?h++:i++;return k.compute_stats(f,h,i,j)}e.hypothesis_function=g,e.cost_function=h,e.test_function=i;var j=new b(a,c,d,e);return j},d.neural_network=function(a,c,d,e){function g(a,b){b=i.reroll_matrix_array(b,n);var c=h(a,b);return c.a[c.a.length-1]}function h(a,b){var c,d,e,g,h,i=b.length+1,j=new Array(i),k=new Array(i-1);for(j[0]=a,c=0;i-1>c;c++)for(0!==c&&j[c].unshift(1),h=b[c].length,j[c+1]=new Array(h),k[c]=new Array(h).fill(0),g=0;h>g;g++){for(e=b[c][g].length,d=0;e>d;d++)k[c][g]+=j[c][d]*b[c][g][d];j[c+1][g]=f.sigmoid(k[c][g])}return{a:j,z:k}}function j(a,b,c,d){var e,f,g,h,j,k;k=b.length+1;var l=new Array(k);for(h=a.length,l[k-1]=new Array(h),e=0;h>e;e++)l[k-1][e]=c[k-1][e]-a[e];for(g=k-2;g>=0;g--){h=c[g].length-1,j=l[g+1].length,l[g]=new Array(h).fill(0);var m=i.matrix_copy(b[g]);for(e=0;e<m.length;e++)m[e].shift();for(f=0;j>f;f++)for(e=0;h>e;e++)l[g][e]+=l[g+1][f]*m[f][e];if(g>0)for(e=0;h>e;e++)l[g][e]=l[g][e]*(c[g][e+1]*(1-c[g][e+1]))}return l}function l(a,b,c,d){var e,g,k,l,m,o,p,q,r,s=b[0].length;o=a.length;var t={J:0,grad:new Array(c.length).fill(0)};c=i.reroll_matrix_array(c,n);var u=new Array(o),v=new Array(o),w=new Array(o);for(e=0;o>e;e++){var x=h(a[e],c);u[e]=x.a,v[e]=x.z,w[e]=u[e][u[e].length-1]}for(e=0;o>e;e++)for(l=0;s>l;l++)t.J+=b[e][l]*f.log(w[e][l])+(1-b[e][l])*f.log(1-w[e][l]);t.J=-1*t.J/o;var y=new Array(o);for(e=0;o>e;e++)y[e]=j(b[e],c,u[e],v[e]);p=c.length+1;var z=new Array(p-1);for(m=0;p-1>m;m++)for(r=c[m].length,z[m]=new Array(r),k=0;r>k;k++)for(q=c[m][k].length,z[m][k]=new Array(q).fill(0),g=0;q>g;g++){for(e=0;o>e;e++)z[m][k][g]+=y[e][m+1][k]*u[e][m][g];z[m][k][g]=z[m][k][g]/o}if(0!==d){var A=0;for(m=0;p-1>m;m++)for(r=c[m].length,k=0;r>k;k++)for(q=c[m][k].length,g=1;q>g;g++)A+=c[m][k][g]*c[m][k][g],z[m][k][g]+=d*c[m][k][g]/o;t.J+=d*A/(2*o)}return t.grad=i.unroll_matrix_array(z),t}function m(a,b,c){var d,e,f,h=0,i=0,j=0,l=0,m=a.length;for(d=0;m>d;d++)for(f=g(a[d],c),e=0;e<b[d].length;e++)f[e]=Math.round(f[e]),1===b[d][e]?1===f[e]?h++:l++:1===f[e]?i++:j++;return k.compute_stats(h,i,j,l)}var n=(d.length+1,i.matrix_array_size(d)),o=i.unroll_matrix_array(d);e.hypothesis_function=g,e.cost_function=l,e.test_function=m;var p=new b(a,c,o,e);return p},d.linear_neural_network=function(a,c,d,e){function f(a,b){b=i.reroll_matrix_array(b,k);var c=g(a,b);return c.a[c.a.length-1]}function g(a,b){var c,d,e,f,g,h=b.length+1,i=new Array(h),j=new Array(h-1);for(i[0]=a,c=0;h-1>c;c++)for(0!==c&&i[c].unshift(1),g=b[c].length,i[c+1]=new Array(g),j[c]=new Array(g).fill(0),f=0;g>f;f++){for(e=b[c][f].length,d=0;e>d;d++)j[c][f]+=i[c][d]*b[c][f][d];i[c+1][f]=j[c][f]<0?0:j[c][f]}return{a:i,z:j}}function h(a,b,c,d){var e,f,g,h,j,k;k=b.length+1;var l=new Array(k);for(h=a.length,l[k-1]=new Array(h),e=0;h>e;e++)l[k-1][e]=(c[k-1][e]-a[e])*(d[k-2][e]<0?0:1);for(g=k-2;g>=0;g--){h=c[g].length-1,j=l[g+1].length,l[g]=new Array(h).fill(0);var m=i.matrix_copy(b[g]);for(e=0;e<m.length;e++)m[e].shift();for(f=0;j>f;f++)for(e=0;h>e;e++)l[g][e]+=l[g+1][f]*m[f][e];if(g>0)for(e=0;h>e;e++)l[g][e]=l[g][e]*(d[g-1][e]<0?0:1)}return l}function j(a,b,c,d){var e,f,j,l,m,n,o,p,q,r=b[0].length;n=a.length;var s={J:0,grad:new Array(c.length).fill(0)};c=i.reroll_matrix_array(c,k);var t=new Array(n),u=new Array(n),v=new Array(n);for(e=0;n>e;e++){var w=g(a[e],c);t[e]=w.a,u[e]=w.z,v[e]=t[e][t[e].length-1]}for(e=0;n>e;e++)for(l=0;r>l;l++){var x=v[e][l]-b[e][l];s.J+=x*x}s.J=s.J/(2*n);var y=new Array(n);for(e=0;n>e;e++)y[e]=h(b[e],c,t[e],u[e]);o=c.length+1;var z=new Array(o-1);for(m=0;o-1>m;m++)for(q=c[m].length,z[m]=new Array(q),j=0;q>j;j++)for(p=c[m][j].length,z[m][j]=new Array(p).fill(0),f=0;p>f;f++){for(e=0;n>e;e++)z[m][j][f]+=y[e][m+1][j]*t[e][m][f];z[m][j][f]=z[m][j][f]/n}if(0!==d){var A=0;for(m=0;o-1>m;m++)for(q=c[m].length,j=0;q>j;j++)for(p=c[m][j].length,f=1;p>f;f++)A+=c[m][j][f]*c[m][j][f],z[m][j][f]+=d*c[m][j][f]/n;s.J+=d*A/(2*n)}return s.grad=i.unroll_matrix_array(z),s}var k=(d.length+1,i.matrix_array_size(d)),l=i.unroll_matrix_array(d);e.hypothesis_function=f,e.cost_function=j;var m=new b(a,c,l,e);return m},d.q_learning=function(a,b,c,d,e){function f(a,b,c){var d=b[c].reduce(function(a,b,c){return b>a?b:a});return d}var g={};g.state_count=a,g.learning_rate=c,g.alpha=c,g.learning_parameter=d,g.gamma=d,g.exact_result=e,g.R=new Array(a),g.Q=new Array(a);var h;for(h=0;a>h;h++)g.R[h]=new Array(a).fill(-1),g.Q[h]=new Array(a).fill(0);return g.update=function(a,c){-1===this.R[a][c]&&(-1!==b.indexOf(c)?this.R[a][c]=100:this.R[a][c]=0),g.exact_result?this.Q[a][c]=Math.max(this.R[a][c],Math.round(this.gamma*f(this.R,this.Q,c))):this.Q[a][c]=this.Q[a][c]+g.alpha*(this.R[a][c]+this.gamma*f(this.R,this.Q,c))},g.get_action_with_best_reward=function(a){var b=f(this.R,this.Q,a);return this.Q[a].indexOf(b)},g},"undefined"!=typeof module&&module.exports&&(module.exports=d),d}();