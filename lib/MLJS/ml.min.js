/*! ml 1.3.1 2016-06-17 */
var ml=function(){function b(a){a=a||{};var b={};return b.learning_rate=a.learning_rate||0,b.stop_criteria=a.stop_criteria||.001,b.min_iter=a.min_iter||100,b.max_iter=a.max_iter||1e3,b.regularization_parameter=a.regularization_parameter||0,b.gradient_check_parameter=a.gradient_check_parameter||1e-4,b.hypothesis_function=a.hypothesis_function,b.cost_function=a.cost_function,b.test_function=a.test_function,b.feature_scalling=a.feature_scalling,void 0===a.feature_scalling&&(b.feature_scalling=!1),b.gradient_check=a.gradient_check,void 0===a.gradient_check&&(b.gradient_check=!1),b.perform_test=a.perform_test,void 0===a.perform_test&&(b.perform_test=!1),b.add_bias=a.add_bias,void 0===a.add_bias&&(b.add_bias=!0),b.alpha=b.learning_rate,b.lambda=b.regularization_parameter,b.epsilon=b.gradient_check_parameter,b}function e(a,c,d,e){var f;this.config=b(e),this.training_size=a.length,this.feature_count=d.length,this.M=this.training_size,this.M_test=void 0,this.N=this.feature_count,this.X=s.matrix_copy(a),this.X_test=void 0,this.config.feature_scalling&&(f=t.feature_scalling(this.X,!0),this.X=f.matrix,this.feature_scalling_parameters=f.feature_scalling_parameters),this.config.add_bias&&(this.X=t.add_bias_feature(this.X,!0)),this.y=q.multi_array_copy(c),this.y_test=void 0,this.theta=q.multi_array_copy(d),f=t.data_shuffle(this.X,this.y,!0),this.X=f.X,this.y=f.y,this.config.perform_test&&(this.M_test=Math.round(.3*this.M),this.M=this.M-this.M_test,this.X_test=s.matrix_slice(this.X,this.M),this.X=s.matrix_slice(this.X,0,this.M),Array.isArray(c[0])?(this.y_test=s.matrix_slice(this.y,this.M),this.y=s.matrix_slice(this.y,0,this.M)):(this.y_test=this.y.slice(this.M),this.y=this.y.slice(0,this.M))),this.J=[],this.iter_count=0,this.divergence=!1,this.error=!1,this.message="",this.execution_time=0}function f(a,b,c,d,e){this.input_unit_count=a+1,this.output_unit_count=b,this.weight_init_f=c,this.activation_f=d,this.activation_f_derivative=e,this.weights=new Array(this.output_unit_count);var f,g;for(g=0;g<this.output_unit_count;g++)for(this.weights[g]=new Array(this.input_unit_count),f=0;f<this.input_unit_count;f++)this.weights[g][f]=c()}function g(a){this.cost_f=a,this.layers=[],this.layer_count=0}function h(a){this.config={},this.config.learning_rate=a.learning_rate||0,this.config.stop_criteria=a.stop_criteria||.001,this.config.min_iter=a.min_iter||100,this.config.max_iter=a.max_iter||1e3,this.config.regularization_parameter=a.regularization_parameter||0,this.config.gradient_check_parameter=a.gradient_check_parameter||1e-4,this.config.feature_scalling=void 0!==a.feature_scalling?a.feature_scalling:!1,this.config.alpha=this.config.learning_rate,this.config.lambda=this.config.regularization_parameter,this.config.epsilon=this.config.gradient_check_parameter}var k={},l=function(){return{}}();k.utils=l;var m=function(){function a(a){return 1/(1+Math.exp(-a))}function b(b){var c=a(b);return c*(1-c)}function c(a){var b=Math.log(a);return b===-(1/0)&&(b=-Number.MAX_VALUE),b}function d(){}return{sigmoid:a,sigmoid_gradient:b,log:c,test:d}}();k.math_utils=m;var p=function(){function a(a,b){b||(a=array_copy(a));for(var c,d,e=a.length;e;)c=Math.random()*e|0,e--,d=a[e],a[e]=a[c],a[c]=d;return a}function b(){}return{array_shuffle:a,test:b}}();k.array_utils=p;var q=function(){function a(b){if(void 0===b)return b;var c=b.length;if(void 0===c)return b;for(var d=new Array(c),e=0;c>e;e++)void 0!==b[e].length?d[e]=a(b[e]):d[e]=b[e];return d}function b(b,c){c||(b=a(b));var d=[];void 0!==b.length&&d.push(b);for(var e,f,g;d.length>0;)for(e=d.pop(),g=e.length,f=0;g>f;f++)void 0!==e[f].length?d.push(e[f]):e[f]=Math.random();return b}return{multi_array_copy:a,multi_array_random_init:b}}();k.multi_array_utils=q;var s=function(){function a(a){var b,c;return b=a.length,c=0,b>0&&(c=a[0].length),[b,c]}function b(b){for(var c=new Array(b.length),d=0;d<b.length;d++)c[d]=a(b[d]);return c}function c(b,c){var d=a(b),e=d[0],f=d[1];c||(c=0,1===f&&(c=1));var g,h,i;if(0===c)for(g=new Array(f).fill(0),i=0;f>i;i++)for(h=0;e>h;h++)g[i]+=b[h][i];else for(g=new Array(e).fill(0),h=0;e>h;h++)for(i=0;f>i;i++)g[h]+=b[h][i];return g}function d(b,c){var d=a(b),e=a(c);if(d[0]!==e[0]||d[1]!==e[1])return!1;var f,g;for(f=0;f<d[0];f++)for(g=0;g<d[1];g++)if(b[f][g]!==c[f][g])return!1;return!0}function e(a){var b,c=a.length;if(void 0===c||0===c)return a;var d=new Array(c);if(Array.isArray(a[0]))for(b=0;c>b;b++)d[b]=a[b].slice();else for(b=0;c>b;b++)d[b]=a[b];return d}function f(b,c){c||(b=e(b));var d,f,g=a(b),h=g[0],i=g[1];for(d=0;h>d;d++)for(f=0;i>f;f++)b[d][f]=m.sigmoid(b[d][f]);return b}function g(a){var b,c,d,e=[];for(b=0;b<a.length;b++)for(c=0;c<a[b].length;c++)for(d=0;d<a[b][c].length;d++)e.push(a[b][c][d]);return e}function h(a,b){var c,d,e,f,g,h,i,j;for(e=b.length,j=0,c=new Array(e),d=0;e>d;d++)for(g=b[d][0],i=b[d][1],c[d]=new Array(g),f=0;g>f;f++)for(c[d][f]=new Array(i),h=0;i>h;h++)c[d][f][h]=a[j],j++;return c}function i(a,b,c){b=b||0,c=c||a.length;var d,e=c-b,f=new Array(e);for(d=0;e>d;d++)f[d]=a[b+d].slice();return f}return{matrix_size:a,matrix_array_size:b,matrix_sum:c,matrix_equals:d,matrix_copy:e,matrix_sigmoid:f,unroll_matrix_array:g,reroll_matrix_array:h,matrix_slice:i}}();k.matrix_utils=s;var t=function(){function a(a,b){b||(a=s.matrix_copy(a));for(var c=a.length,d=0;c>d;d++)a[d].unshift(1);return a}function b(a,b,c){c||(a=s.matrix_copy(a));var d,e,f,g=s.matrix_size(a),h=g[0],i=g[1];for(d=0;h>d;d++)for(e=0;i>e;e++)for(f=2;b+1>f;f++)a[d].push(Math.pow(a[d][e],f));return a}function d(a,b){b||(a=s.matrix_copy(a));var c,d,e=matrix_size(a),f=e[0],g=e[1],h=new Array(g).fill(0),i=new Array(g).fill(0);for(d=0;g>d;d++){for(c=1;f>c;c++)h[d]+=a[c][d];h[d]=h[d]/f}for(d=0;g>d;d++){for(c=0;f>c;c++)i[d]+=a[c][d]*a[c][d];i[d]=i[d]/f,i[d]=i[d]-h[d]*h[d],i[d]=Math.sqrt(i[d])}for(c=0;f>c;c++)for(d=0;g>d;d++)a[c][d]=(a[c][d]-h[d])/i[d];return{matrix:a,feature_scalling_parameters:{mean:h,std:i}}}function e(a,b,d,e){e||(a=s.matrix_copy(a));var f=matrix_size(a),g=f[0],h=f[1];for(r=0;r<g;r++)for(c=0;c<h;c++)a[r][c]=(a[r][c]-b[c])/d[c];return a}function f(a,b,c,d){var e,f,g,h;return e=(a+c)/(a+b+c+d),f=a/(a+b),g=a/(a+d),h=2*f*g/(f+g),{TP:a,FP:b,TN:c,FN:d,accuracy:e,precision:f,recall:g,f1_score:h}}function g(a,b,c){c||(a=s.matrix_copy(a),b=s.matrix_copy(b));for(var d,e,f=a.length;f;)d=Math.random()*f|0,f--,e=a[f],a[f]=a[d],a[d]=e,e=b[f],b[f]=b[d],b[d]=e;return{X:a,y:b}}function h(a){var b,c,d,e,f,g;for(c=a.length,g=new Array(c-1),b=0;c-1>b;b++)for(e=a[b+1],g[b]=new Array(a[b+1]),d=0;e>d;d++)f=a[b]+1,g[b][d]=new Array(f).fill(0);return g}function i(a,b,c,d){d||(a=q.multi_array_copy(a)),b=b||0,c=c||1,extents=c-b;var e,f,g,h,i,j;for(f=a.length,e=0;f>e;e++)for(h=a[e].length,g=0;h>g;g++)for(j=a[e][g].length,i=0;j>i;i++)a[e][g][i]=Math.random()*extents+b;return a}return{add_bias_feature:a,feature_polynomial_combine:b,feature_scalling:d,scale_features:e,compute_stats:f,data_shuffle:g,nn_theta_create:h,nn_theta_random_init:i}}();k.ml_utils=t,e.prototype.predict=function(a){return a=a.slice(),a.unshift(1),this.config.hypothesis_function(a,this.theta)},e.prototype.gradient_descent=function(){var a=(new Date).getTime();if(this.config.gradient_check&&!this.check_gradient(this.X,this.y,this.theta,this.config.epsilon,this.config.cost_function))return this.error=!0,this.message="Gradient check failed, seems like the algorithm you're trying to use is broken, sorry.",this;0===this.config.alpha&&(this.config.alpha=this.choose_learning_rate(this.X,this.y,this.theta,this.config),this.config.learning_rate=this.config.alpha);for(var b=this.gradient_step(this.X,this.y),c=this.gradient_step(this.X,this.y);(Math.abs(b-c)>this.config.stop_criteria||this.iter_count<this.config.min_iter)&&this.iter_count<this.config.max_iter;){if(0>b-c){this.divergence=!0;break}b=c,c=this.gradient_step(this.X,this.y)}this.config.perform_test&&(this.test_results=this.config.test_function(this.X_test,this.y_test,this.theta));var d=(new Date).getTime();this.execution_time=d-a},e.prototype.batched_gradient_descent=function(a){var b=(new Date).getTime();if(this.config.gradient_check&&!this.check_gradient(this.X,this.y,this.theta,this.config.epsilon,this.config.cost_function))return this.error=!0,this.message="Gradient check failed, seems like the algorithm you're trying to use is broken, sorry.",this;for(var c=0;c<this.M;c+=a)this.gradient_step(this.X.slice(c,c+a),this.y.slice(c,c+a));this.config.perform_test&&(this.test_results=this.config.test_function(this.X_test,this.y_test,this.theta));var d=(new Date).getTime();this.execution_time=d-b},e.prototype.gradient_step=function(a,b){var c=this.config.cost_function(a,b,this.theta,this.config.lambda);for(j=0;j<this.N;j++)this.theta[j]-=this.config.alpha*c.grad[j];return this.J.push(c.J),this.iter_count++,c.J},e.prototype.online_gradient_descent=function(a,b){return a=a.slice(),a.unshift(1),a=[a],b=[b],this.gradient_step(a,b)},e.prototype.check_gradient=function(a,b,c,d,e){c=q.multi_array_copy(c);var f,g,h,i=e(a,b,c,0);for(n=0;n<this.N;n++)return c[n]+=d,f=e(a,b,c,0),c[n]-=2*d,g=e(a,b,c,0),c[n]+=d,h=(f.J-g.J)/(2*d),i.grad[n]===h&&0===h?!0:Math.abs(i.grad[n]-h)/(Math.abs(i.grad[n])+Math.abs(h))<2*d},e.prototype.choose_learning_rate=function(a,c,d,f){for(f=b(f),f.learning_rate=1,f.add_bias=!1,f.feature_scalling=!1,ctx=new e(a,c,d,f);!ctx.divergence;)f.learning_rate*=3,ctx=new e(a,c,d,f),ctx.gradient_descent();for(;ctx.divergence;)f.learning_rate/=3,ctx=new e(a,c,d,f),ctx.gradient_descent();return f.learning_rate},k.polynomial_regression=function(a,b,c,d){function f(a,b){var c,d=0,e=b.length;for(c=0;e>c;c++)d+=a[c]*b[c];return d}function g(a,b,c,d){var e,g,h,i;h=a.length,i=c.length;var j={J:0,grad:new Array(i).fill(0)},k=new Array(h),l=new Array(h);for(e=0;h>e;e++)k[e]=f(a[e],c),l[e]=k[e]-b[e];for(e=0;h>e;e++)j.J+=l[e]*l[e];for(j.J=j.J/(2*h),g=0;i>g;g++){for(e=0;h>e;e++)j.grad[g]+=l[e]*a[e][g];j.grad[g]=j.grad[g]/h}if(0!==d){var m=0;for(g=1;i>g;g++)m+=c[g]*c[g],j.grad[g]+=d*c[g]/h;j.J+=d*m}return j}d.hypothesis_function=f,d.cost_function=g;var h=new e(a,b,c,d);return h},k.logistic_regression=function(a,b,c,d){function f(a,b){var c,d=0,e=b.length;for(c=0;e>c;c++)d+=a[c]*b[c];return d=m.sigmoid(d)}function g(a,b,c,d){var e,g,h,i;h=a.length,i=c.length;var j={J:0,grad:new Array(i).fill(0)},k=new Array(h),l=new Array(h);for(e=0;h>e;e++)k[e]=f(a[e],c),l[e]=k[e]-b[e];for(e=0;h>e;e++)j.J+=b[e]*m.log(k[e])+(1-b[e])*m.log(1-k[e]);for(j.J=-1*j.J/h,g=0;i>g;g++){for(e=0;h>e;e++)j.grad[g]+=l[e]*a[e][g];j.grad[g]=j.grad[g]/h}if(0!==d){var n=0;for(g=1;i>g;g++)n+=c[g]*c[g],j.grad[g]+=d*c[g]/h;j.J+=d*n/(2*h)}return j}function h(a,b,c){var d,e,g=0,h=0,i=0,j=0,k=a.length;for(d=0;k>d;d++)e=Math.round(f(a[d],c)),1===b[d]?1===e?g++:j++:1===e?h++:i++;return t.compute_stats(g,h,i,j)}d.hypothesis_function=f,d.cost_function=g,d.test_function=h;var i=new e(a,b,c,d);return i},k.neural_network=function(a,b,c,d){function f(a,b){b=s.reroll_matrix_array(b,k);var c=g(a,b);return c.a[c.a.length-1]}function g(a,b){var c,d,e,f,g,h=b.length+1,i=new Array(h),j=new Array(h-1);for(i[0]=a,c=0;h-1>c;c++)for(0!==c&&i[c].unshift(1),g=b[c].length,i[c+1]=new Array(g),j[c]=new Array(g).fill(0),f=0;g>f;f++){for(e=b[c][f].length,d=0;e>d;d++)j[c][f]+=i[c][d]*b[c][f][d];i[c+1][f]=m.sigmoid(j[c][f])}return{a:i,z:j}}function h(a,b,c,d){var e,f,g,h,i,j;j=b.length+1;var k=new Array(j);for(h=a.length,k[j-1]=new Array(h),e=0;h>e;e++)k[j-1][e]=c[j-1][e]-a[e];for(g=j-2;g>=0;g--){h=c[g].length-1,i=k[g+1].length,k[g]=new Array(h).fill(0);var l=s.matrix_copy(b[g]);for(e=0;e<l.length;e++)l[e].shift();for(f=0;i>f;f++)for(e=0;h>e;e++)k[g][e]+=k[g+1][f]*l[f][e];if(g>0)for(e=0;h>e;e++)k[g][e]=k[g][e]*(c[g][e+1]*(1-c[g][e+1]))}return k}function i(a,b,c,d){var e,f,i,j,l,n,o,p,q,r=b[0].length;n=a.length;var t={J:0,grad:new Array(c.length).fill(0)};c=s.reroll_matrix_array(c,k);var u=new Array(n),v=new Array(n),w=new Array(n);for(e=0;n>e;e++){var x=g(a[e],c);u[e]=x.a,v[e]=x.z,w[e]=u[e][u[e].length-1]}for(e=0;n>e;e++)for(j=0;r>j;j++)t.J+=b[e][j]*m.log(w[e][j])+(1-b[e][j])*m.log(1-w[e][j]);t.J=-1*t.J/n;var y=new Array(n);for(e=0;n>e;e++)y[e]=h(b[e],c,u[e],v[e]);o=c.length+1;var z=new Array(o-1);for(l=0;o-1>l;l++)for(q=c[l].length,z[l]=new Array(q),i=0;q>i;i++)for(p=c[l][i].length,z[l][i]=new Array(p).fill(0),f=0;p>f;f++){for(e=0;n>e;e++)z[l][i][f]+=y[e][l+1][i]*u[e][l][f];z[l][i][f]=z[l][i][f]/n}if(0!==d){var A=0;for(l=0;o-1>l;l++)for(q=c[l].length,i=0;q>i;i++)for(p=c[l][i].length,f=1;p>f;f++)A+=c[l][i][f]*c[l][i][f],z[l][i][f]+=d*c[l][i][f]/n;t.J+=d*A/(2*n)}return t.grad=s.unroll_matrix_array(z),t}function j(a,b,c){var d,e,g,h=0,i=0,j=0,k=0,l=a.length;for(d=0;l>d;d++)for(g=f(a[d],c),e=0;e<b[d].length;e++)g[e]=Math.round(g[e]),1===b[d][e]?1===g[e]?h++:k++:1===g[e]?i++:j++;return t.compute_stats(h,i,j,k)}var k=(c.length+1,s.matrix_array_size(c)),l=s.unroll_matrix_array(c);d.hypothesis_function=f,d.cost_function=i,d.test_function=j;var n=new e(a,b,l,d);return n},k.linear_neural_network=function(a,b,c,d){function f(a,b){b=s.reroll_matrix_array(b,j);var c=g(a,b);return c.a[c.a.length-1]}function g(a,b){var c,d,e,f,g,h=b.length+1,i=new Array(h),j=new Array(h-1);for(i[0]=a,c=0;h-1>c;c++)for(0!==c&&i[c].unshift(1),g=b[c].length,i[c+1]=new Array(g),j[c]=new Array(g).fill(0),f=0;g>f;f++){for(e=b[c][f].length,d=0;e>d;d++)j[c][f]+=i[c][d]*b[c][f][d];i[c+1][f]=j[c][f]<0?0:j[c][f]}return{a:i,z:j}}function h(a,b,c,d){var e,f,g,h,i,j;j=b.length+1;var k=new Array(j);for(h=a.length,k[j-1]=new Array(h),e=0;h>e;e++)k[j-1][e]=(c[j-1][e]-a[e])*(d[j-2][e]<0?0:1);for(g=j-2;g>=0;g--){h=c[g].length-1,i=k[g+1].length,k[g]=new Array(h).fill(0);var l=s.matrix_copy(b[g]);for(e=0;e<l.length;e++)l[e].shift();for(f=0;i>f;f++)for(e=0;h>e;e++)k[g][e]+=k[g+1][f]*l[f][e];if(g>0)for(e=0;h>e;e++)k[g][e]=k[g][e]*(d[g-1][e]<0?0:1)}return k}function i(a,b,c,d){var e,f,i,k,l,m,n,o,p,q=b[0].length;m=a.length;var r={J:0,grad:new Array(c.length).fill(0)};c=s.reroll_matrix_array(c,j);var t=new Array(m),u=new Array(m),v=new Array(m);for(e=0;m>e;e++){var w=g(a[e],c);t[e]=w.a,u[e]=w.z,v[e]=t[e][t[e].length-1]}for(e=0;m>e;e++)for(k=0;q>k;k++){var x=v[e][k]-b[e][k];r.J+=x*x}r.J=r.J/(2*m);var y=new Array(m);for(e=0;m>e;e++)y[e]=h(b[e],c,t[e],u[e]);n=c.length+1;var z=new Array(n-1);for(l=0;n-1>l;l++)for(p=c[l].length,z[l]=new Array(p),i=0;p>i;i++)for(o=c[l][i].length,z[l][i]=new Array(o).fill(0),f=0;o>f;f++){for(e=0;m>e;e++)z[l][i][f]+=y[e][l+1][i]*t[e][l][f];z[l][i][f]=z[l][i][f]/m}if(0!==d){var A=0;for(l=0;n-1>l;l++)for(p=c[l].length,i=0;p>i;i++)for(o=c[l][i].length,f=1;o>f;f++)A+=c[l][i][f]*c[l][i][f],z[l][i][f]+=d*c[l][i][f]/m;r.J+=d*A/(2*m)}return r.grad=s.unroll_matrix_array(z),r}var j=(c.length+1,s.matrix_array_size(c)),k=s.unroll_matrix_array(c);d.hypothesis_function=f,d.cost_function=i;var l=new e(a,b,k,d);return l},k.q_learning=function(a,b,c,d,e){function f(a,b,c){var d=b[c].reduce(function(a,b,c){return b>a?b:a});return d}var g={};g.state_count=a,g.learning_rate=c,g.alpha=c,g.learning_parameter=d,g.gamma=d,g.exact_result=e,g.R=new Array(a),g.Q=new Array(a);var h;for(h=0;a>h;h++)g.R[h]=new Array(a).fill(-1),g.Q[h]=new Array(a).fill(0);return g.update=function(a,c){-1===this.R[a][c]&&(-1!==b.indexOf(c)?this.R[a][c]=100:this.R[a][c]=0),g.exact_result?this.Q[a][c]=Math.max(this.R[a][c],Math.round(this.gamma*f(this.R,this.Q,c))):this.Q[a][c]=this.Q[a][c]+g.alpha*(this.R[a][c]+this.gamma*f(this.R,this.Q,c))},g.get_action_with_best_reward=function(a){var b=f(this.R,this.Q,a);return this.Q[a].indexOf(b)},g};var u=function(){function a(a){var b,c,d,e=a.length,f=a[0].length,g=new Array(f).fill(0),h=new Array(f).fill(0);for(d=0;f>d;d++){for(c=1;e>c;c++)g[d]+=a[c][d];g[d]=g[d]/e}for(d=0;f>d;d++){for(c=0;e>c;c++)h[d]+=a[c][d]*a[c][d];h[d]=h[d]/e,h[d]=h[d]-g[d]*g[d],h[d]=Math.sqrt(h[d])}for(b=new Array(e),c=0;e>c;c++)for(b[c]=new Array(f),d=0;f>d;d++)b[c][d]=(a[c][d]-g[d])/h[d];return{matrix:a,feature_scalling_parameters:{mean:g,std:h}}}function b(a,b){var c,d,e,f=a.length,g=a[0].length,h=0;for(c=0;f>c;c++)for(d=0;g>d;d++)e=a[c][d]-b[c][d],h+=e*e;return h/=2*f}function c(a){return 0>a?0:a}function d(a){return 0>a?0:1}function e(a){return 1/(1+Math.exp(-a))}function f(a){var b=e(a);return b*(1-b)}return{feature_scalling:a,MSE:b,ReLU:c,ReLU_derivative:d,sigmoid:e,sigmoid_derivative:f}}();return k.NN=k.NN||{},k.NN.utils=u,k.NN=k.NN||{},k.NN.FullyConnectedLayer=f,f.prototype.forward_propagation=function(b){var c,d,e;for(e=new Array(this.output_unit_count).fill(0),a=new Array(this.output_unit_count),d=0;d<this.output_unit_count;d++){for(c=0;c<this.input_unit_count;c++)e[d]+=b[c]*this.weights[d][c];a[d]=this.activation_f(e[d])}return{a:a,z:e}},f.prototype.backward_propagation=function(a,b){var c,d,e=new Array(this.input_unit_count-1).fill(0);for(c=1;c<this.input_unit_count;c++){for(d=0;d<this.output_unit_count;d++)e[c-1]+=a[d]*this.weights[d][c];e[c-1]*=this.activation_f_derivative(b[c])}return e},f.prototype.last_layer_gradient_compute=function(a,b,c){var d,e=new Array(a.length);for(d=0;d<this.output_unit_count;d++)e[d]=(a[d]-c[d])*this.activation_f_derivative(b[d]);return e},f.prototype.weights_update=function(a,b){for(i=0;i<this.input_unit_count;i++)for(o=0;o<this.output_unit_count;o++)this.weights[o][i]-=b*a[o][i]},k.NN=k.NN||{},k.NN.NeuralNetwork=g,g.prototype.add_layer=function(a){this.layers[this.layer_count]=a,this.layer_count++},g.prototype.predict=function(a){var b=this.layer_count,c=this.forward_propagation(a).a[b];return c},g.prototype.compute_cost=function(a,b,c){var d,e,f,g,h,i,j=a.length,k=new Array(j),l=new Array(j),m=new Array(j),n=new Array(j);for(f=0;j>f;f++)g=this.forward_propagation(a[f]),l[f]=g.a,m[f]=g.z,e=l[f].length-1,d=l[f][e].length,k[f]=l[f][e],g=this.backward_propagation(l[f],m[f],b[f]),n[f]=g.d;return h=this.cost_f(k,b),i=this.compute_gradient(n,l),this.regularize(h,i,c,j)},g.prototype.compute_gradient=function(a,b){var c,d,e,f,g,h,i=new Array(this.layers),j=this.layers.length,k=a.length;for(d=0;j>d;d++)for(g=this.layers[d].output_unit_count,i[d]=new Array(g),e=0;g>e;e++)for(h=this.layers[d].input_unit_count,i[d][e]=new Array(h).fill(0),f=0;h>f;f++){for(c=0;k>c;c++)i[d][e][f]+=a[c][d][e]*b[c][d][f];i[d][e][f]=i[d][e][f]/k}return i},g.prototype.check_gradient=function(a,b,c){var d,e,f,g,h,i,j,k,l,m=this.layer_count;for(i=this.compute_cost(a,b,0).grad,f=0;m>f;f++)for(d=this.layers[f].input_unit_count,e=this.layers[f].output_unit_count,h=0;d>h;h++)for(g=0;e>g;g++)if(this.layers[f].weights[g][h]-=c,j=this.compute_cost(a,b,0).J,this.layers[f].weights[g][h]+=2*c,k=this.compute_cost(a,b,0).J,this.layers[f].weights[g][h]-=c,l=(j+k)/(2*c),(i[n]!==l||0!==l)&&Math.abs(i[n]-l)/(Math.abs(i[n])+Math.abs(l))<2*c)return!1;return!0},g.prototype.regularize=function(a,b,c,d){var e,f,g,h,i,j=this.layers.length,k={J:a,grad:b};if(0!==c){var l=0;for(e=0;j>e;e++)for(h=this.layers[e].output_unit_count,f=0;h>f;f++)for(i=this.layers[e].input_unit_count,g=1;i>g;g++)l+=this.layers[e].weights[f][g]*this.layers[e].weights[f][g],k.grad[e][f][g]+=c*this.layers[e].weights[f][g]/d;k.J+=c*l/(2*d)}return k},g.prototype.forward_propagation=function(a){var b,c,d=this.layer_count,e=new Array(d),f=new Array(d+1);for(f[0]=a.slice(),f[0].unshift(1),b=0;d>b;b++)c=this.layers[b].forward_propagation(f[b]),b+1!==d&&c.a.unshift(1),e[b]=c.z,f[b+1]=c.a;return{a:f,z:e}},g.prototype.backward_propagation=function(a,b,c){var e,f=this.layer_count;for(d=new Array(f),e=f-1;e>0;e--)e===f-1&&(d[e]=this.layers[f-1].last_layer_gradient_compute(a[f],b[f-1],c)),d[e-1]=this.layers[e].backward_propagation(d[e],b[e]);return{d:d}},g.prototype.weights_update=function(a,b){var c,d=this.layer_count;for(c=0;d>c;c++)this.layers[c].weights_update(a[c],b)},k.NN=k.NN||{},k.NN.GradientDescent=h,h.prototype.init_gradient_descent_ctx=function(){return{J:[],iter_count:0,divergence:!1,error:!1,message:"",execution_time:0}},h.prototype.perform_gradient_descent=function(a,b,c,d,e){var f=(new Date).getTime(),g=this.init_gradient_descent_ctx();this.config.feature_scalling&&(g=NN.utils.feature_scalling(a),a=g.matrix,g.feature_scalling_parameters=g.feature_scalling_parameters);var h=this.gradient_step(a,b,this.config.alpha,this.config.lambda,c,d,e);g.J.push(h),g.iter_count++;var i=this.gradient_step(a,b,this.config.alpha,this.config.lambda,c,d,e);for(g.J.push(i),g.iter_count++;(Math.abs(h-i)>this.config.stop_criteria||g.iter_count<this.config.min_iter)&&g.iter_count<this.config.max_iter;){if(0>h-i){g.divergence=!0;break}h=i,i=this.gradient_step(a,b,this.config.alpha,this.config.lambda,c,d,e),g.J.push(i),g.iter_count++}var j=(new Date).getTime();return g.execution_time=j-f,g},h.prototype.batched_gradient_descent=function(a,b,c,d,e,f){var g=(new Date).getTime(),h=a||this.init_gradient_descent_ctx(),i=this.gradient_step(b,c,this.config.alpha,this.config.lambda,d,e,f);h.J.push(i),h.iter_count++;var j=(new Date).getTime();return h.execution_time+=j-g,h},h.prototype.gradient_step=function(a,b,c,d,e,f,g){var h=e[f](a,b,d);return e[g](h.grad,c),h.J},"undefined"!=typeof module&&module.exports&&(module.exports=k),k}();